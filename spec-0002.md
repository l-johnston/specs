---
title: "SPEC 2 â€” Unit Systems Support"
date: 2021-03-20
draft: true
author:
  - "Lee Johnston <lee.johnston.100@gmail.com>"
discussion: https://discuss.scientific-python.org/t/
endorsed-by:
---

# Description

Computing with quantities associated with units is commonly done by stripping the units from the numerical values and performing all calculations and data processing on pure numbers. This forces the end user to track the units manually which is error prone and reduces code readability.

Making the computations "unit aware" currently requires a custom type that holds the numerical values, units and unit system behaviors. There are several such implementations including `unyt`, `Pint`, `astropy.units` and `sympy.physics.units`. They each take a different approach and so long as the computations remain within the respective library, they each support the intended use case. 

Compatibility problems arise when propagating the custom type into other libraries. Consider for example a pipeline that involves `unyt` and `matplotlib` that raises an exception when attempting to plot a histogram of a physical quantity array.

```python
import matplotlib.pyplot as plt
from unyt import matplotlibsupport, m

# register unyt's conversion interface with matplotlib
matplotlibsupport()

# generate a `unyt_array` object with unit meters
data = [1, 2, 3]*m

plt.hist(data)
...
UnitOperationError: The <ufunc 'subtract'> operator for unyt_arrays with units "dimensionless" (dimensions "1") and "m" (dimensions "(length)") is not well defined.
```

The `unyt_array` object is a Numpy `ndarray` subclass. The exception occurs because `matplotlib` allows the subclass to pass through to its internals where it attempts a subtraction, probably in its "graphical" coordinate system, of a pure number from a physical quantity. This forces the end user to strip the units to proceed.

In other instances, the external library strips the units.

```python
import pandas as pd
from unyt import m

data = [1, 2, 3]*m
type(data)
unyt.array.unyt_array

df = pd.DataFrame({"distance": data})
type(df.distance.values)
numpy.ndarray

df
   distance
0         1
1         2
2         3
```

NumPy is currently developing [extensible DTypes](https://numpy.org/neps/nep-0042-new-dtypes.html) to replace the existing `dtype` to expand the behavior of the native `ndarray` to include unit systems among other use cases. Since the `ndarray` lies at the foundation of most, if not all, technical computing libraries, a unit system implemented with this new DType may solve the compatibility problem.

The purpose of this SPEC is to define a set of requirements for both unit system libraries and external libraries such that when adhered to, an end user will be able to build a pipeline that is "unit aware" from start to finish.

# Implementation

<!--
Discuss how this would be implemented.
-->

## Core Project Endorsement

<!--
Discuss what it means for a core project to endorse this SPEC.
-->

## Ecosystem Adoption

<!--
Discuss what it means for a project to adopt this SPEC.
-->

# Notes

<!--
Include a bulleted list of annotated links, comments,
and other ancillary information as needed.
-->
